var fs = require('fs'),
    path = require('path'),
    _ = require('lodash'),
    dir = path.join(__dirname, 'content');

function getFiles(dir) {
    var r = [];
    try {
        r = fs.readdirSync(dir)
            .filter(function (file) {
                var stat = fs.statSync(path.join(dir, file));
                return (stat.isFile() && (path.extname(file) === '.json'));
            });
    } catch (e) {
        console.log(e);
    }
    return r;
};

function getDirectories(dir) {
    var r = [];
    try {
        var r = fs.readdirSync(dir)
            .filter(function (file) {
                return fs.statSync(path.join(dir, file)).isDirectory();
            });
    } catch (e) {
        console.log(e);
    }
    return r;
};

function getAll() {
    var r = {};
    _.forEach(getDirectories(dir), function (topic) {
        r[topic] = getTopic(topic);
    });
    return r;
}

function getTopic(topic) {
    var r = {};
    r = {};
    _.forEach(getFiles(path.join(dir, topic)), function (file) {
        var name = path.basename(file, '.json')
        r[name] = getOne(topic, name);
    });
    return r;
}

function getOne(topic, name) {
    var r = {};
    try {
        r = require(path.join(dir, topic, name + '.json'));
    } catch (e) {
        console.log(e);
    }
    return r;
}

function get() {
    if (arguments[0] == null && arguments[1] == null) {
        return getAll();
    } else if (arguments[0] != null && arguments[1] == null) {
        return getTopic(arguments[0]);
    } else if (arguments[0] != null && arguments[1] != null) {
        return getOne(arguments[0], arguments[1]);
    }
}

module.exports = get;
